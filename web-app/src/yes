import React, { useEffect, useState } from 'react';
import { GoogleMap, LoadScript, DirectionsService, DirectionsRenderer } from '@react-google-maps/api';

const MyGoogleMap = ({ currentLocation, destination, setLocationName }) => {
  const mapStyles = {
    height: '400px',
    width: '100%',
  };

  const [directions, setDirections] = useState([]);
  const [selectedRouteIndex, setSelectedRouteIndex] = useState(0);

  useEffect(() => {
    if (currentLocation && destination) {
      calculateDirections();
    }
  }, [currentLocation, destination]);

  const calculateDirections = () => {
    const directionsService = new window.google.maps.DirectionsService();
    directionsService.route(
      {
        origin: currentLocation,
        destination: destination,
        travelMode: 'DRIVING',
        provideRouteAlternatives: true,
      },
      (result, status) => {
        if (status === 'OK') {
          setDirections(result.routes);
          setLocationName(`${currentLocation} to ${destination}`);
        } else {
          console.error('Directions request failed due to ' + status);
          setLocationName('Route Not Found');
        }
      }
    );
  };

  return (
    <div>
      <LoadScript googleMapsApiKey="AIzaSyCfZK9eq1sBWYplK3kxdkE7BJ6JkXGsNWs">
        <GoogleMap
          mapContainerStyle={mapStyles}
          zoom={12}
          center={{ lat: -29.311667, lng: 27.481389 }}
        >
          {directions.length > 0 && (
            <DirectionsRenderer directions={{ routes: [directions[selectedRouteIndex]] }} />
          )}
        </GoogleMap>
      </LoadScript>
      {directions.length > 1 && (
        <div>
          <h3>Select a Route:</h3>
          <ul>
            {directions.map((route, index) => (
              <li key={index}>
                <button onClick={() => setSelectedRouteIndex(index)}>
                  Route {index + 1}
                </button>
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
};

export default MyGoogleMap;
